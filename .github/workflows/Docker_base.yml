name: æ„å»º åŸºç¡€é•œåƒ

on:
  workflow_dispatch:

jobs:
  build-base:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: è®¾ç½® QEMU
        uses: docker/setup-qemu-action@v3
        with:
          platforms: linux/amd64,linux/386,linux/arm64,linux/arm/v7,linux/arm/v5

      - name: è®¾ç½® Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ç™»å½•åˆ° Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_PASSWORD }}

      - name: æ„å»ºå¹¶æ¨é€å¤šå¹³å°åŸºç¡€é•œåƒ
        run: |
          BASE_IMAGE_NAME="${{ secrets.DOCKERHUB_USERNAME }}/klipperd"
          echo "ğŸš€ æ„å»ºå¹¶æ¨é€å¤šå¹³å°åŸºç¡€é•œåƒ: ${BASE_IMAGE_NAME}"

          docker buildx build \
            --platform linux/amd64,linux/386,linux/arm64,linux/arm/v7,linux/arm/v5 \
            -f Dockerfile_base \
            --tag "${BASE_IMAGE_NAME}:base" \
            --push \
            .

          echo "âœ… åŸºç¡€é•œåƒ ${BASE_IMAGE_NAME}:base æ„å»ºå¹¶æ¨é€æˆåŠŸ!"